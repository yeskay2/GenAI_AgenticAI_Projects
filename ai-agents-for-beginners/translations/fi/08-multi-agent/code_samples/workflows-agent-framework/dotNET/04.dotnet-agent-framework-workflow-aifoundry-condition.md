<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "8abd335151cee553293b637ee3d80d10",
  "translation_date": "2025-11-11T12:20:41+00:00",
  "source_file": "08-multi-agent/code_samples/workflows-agent-framework/dotNET/04.dotnet-agent-framework-workflow-aifoundry-condition.md",
  "language_code": "fi"
}
-->
# üîÄ Ehdolliset agenttity√∂nkulut Azure AI Foundrylla (.NET)

## üìã √Ñlyk√§s p√§√§t√∂ksentekoon perustuva ty√∂nkulkuopas

T√§m√§ notebook esittelee **ehdollisia ty√∂nkulkuja** k√§ytt√§en Azure AI Foundrya ja Microsoft Agent Frameworkia .NET:lle. Opit rakentamaan kehittyneit√§, p√§√§t√∂ksentekoon perustuvia ty√∂nkulkuja, jotka ohjaavat k√§sittely√§ √§lykk√§√§sti AI-analyysin, liiketoimintas√§√§nt√∂jen ja dynaamisten ehtojen perusteella yritystason automaatiota varten.

## üéØ Oppimistavoitteet

### üß† **√Ñlyk√§s p√§√§t√∂ksentekoarkkitehtuuri**
- **Ehdollisen logiikan toteutus**: Rakenna monimutkaisia p√§√§t√∂spuita, joissa on useita haarautumispisteit√§
- **AI-ohjattu reititys**: K√§yt√§ Azure AI Foundryn malleja √§lykk√§iden reititysp√§√§t√∂sten tekemiseen
- **Dynaaminen ty√∂nkulun mukauttaminen**: Muokkaa ty√∂nkulun k√§ytt√§ytymist√§ ajonaikaisten analyysien ja ehtojen perusteella
- **Liiketoimintas√§√§nt√∂jen integrointi**: Sis√§llyt√§ ty√∂nkulkuihin liiketoimintalogiikkaa ja vaatimustenmukaisuusvaatimuksia

### üîÄ **Kehittyneet ehdolliset mallit**
- **Monikriteerinen p√§√§t√∂ksenteko**: Arvioi useita tekij√∂it√§ reititysp√§√§t√∂sten tekemiseksi
- **Kontekstin huomioiva k√§sittely**: Tee p√§√§t√∂ksi√§ ty√∂nkulun kertyneen kontekstin ja historian perusteella
- **Mukautuva ty√∂nkulun muokkaus**: S√§√§d√§ k√§sittelypolkuja reaaliaikaisten ehtojen perusteella
- **S√§√§nt√∂moottorin integrointi**: Toteuta kehittyneit√§ liiketoimintas√§√§nt√∂moottoreita ty√∂nkulkuihin

### üè¢ **Yritystason ehdolliset sovellukset**
- **Asiakirjojen luokittelu ja reititys**: Luokittele ja ohjaa asiakirjat automaattisesti sopiviin ty√∂nkulkuihin
- **Asiakaspalvelun triage**: Ohjaa asiakaskyselyt √§lykk√§√§sti erikoistuneille k√§sittelytiimeille
- **Vaatimustenmukaisuus ja riskik√§sittely**: Sovella erilaisia validointi- ja tarkistusprosesseja riskinarvioinnin perusteella
- **Laadunvarmistuksen ty√∂nkulut**: Ohjaa sis√§lt√∂√§ sopiviin tarkistusprosesseihin laatumittareiden perusteella

## ‚öôÔ∏è Esivaatimukset ja asennus

### üì¶ **Vaaditut NuGet-paketit**

Kehittyneet paketit ehdolliseen ty√∂nkulun k√§sittelyyn:

```xml
<!-- Core AI Framework -->
<PackageReference Include="Microsoft.Extensions.AI" Version="9.9.0" />

<!-- Azure AI Agents with Persistent State -->
<PackageReference Include="Azure.AI.Agents.Persistent" Version="1.2.0-beta.5" />

<!-- Azure Identity and Utilities -->
<PackageReference Include="Azure.Identity" Version="1.15.0" />
<PackageReference Include="System.Linq.Async" Version="6.0.3" />
<PackageReference Include="DotNetEnv" Version="3.1.1" />

<!-- Local Workflow Framework References -->
<!-- Microsoft.Agents.Workflows.dll - Advanced workflow orchestration -->
<!-- Microsoft.Agents.AI.AzureAI.dll - Azure AI Foundry integration -->
<!-- Microsoft.Agents.AI.dll - Core agent abstractions -->
```

### üîë **Azure AI Foundryn konfigurointi**

**Vaaditut Azure-resurssit:**
- Azure AI Foundry -ty√∂tila ehdollisten k√§sittelymallien kanssa
- Azure-tilaus, jossa on tarvittavat laskentakiinti√∂t ja k√§ytt√∂oikeudet
- P√§√§t√∂ksentekoon ja sis√§ll√∂n analysointiin k√§ytett√§v√§t AI-mallit
- (Valinnainen) Bing Search API -yhteys taustatietojen hankkimiseksi

**Ymp√§rist√∂n konfigurointi (.env-tiedosto):**
```env
# Azure AI Foundry Configuration
AZURE_AI_PROJECT_ENDPOINT=https://your-project.cognitiveservices.azure.com/
BING_CONNECTION_ID=your-bing-connection-id
```

**Autentikointiasetukset:**
```csharp
// Azure CLI or Managed Identity authentication
using Azure.Identity;
var credential = new AzureCliCredential();

// Load environment configuration
DotNetEnv.Env.Load("../../../.env");
```

### üèóÔ∏è **Ehdollisen ty√∂nkulun arkkitehtuuri**

```mermaid
graph TD
    A[Input: Content Outline] --> B[Draft Executor]
    B --> C[Content Review Executor]
    C --> D{Review Decision}
    
    D -->|Yes - Approved| E[Publish Executor]
    D -->|No - Rejected| F[Send Review Executor]
    
    E --> G[Save as Markdown File]
    F --> H[Notify for Revisions]
    
    I[Azure AI Foundry] --> B
    I --> C
    I --> E
    
    J[Bing Grounding] --> B
```

**Keskeiset komponentit:**
- **Draft Executor**: AI-agentti, joka luo alustavat sis√§ll√∂n luonnokset
- **Content Review Executor**: AI-agentti, joka arvioi luonnoksen laatua ja vaatimustenmukaisuutta
- **Ehdollinen reititys**: P√§√§t√∂slogiikka, joka ohjaa tarkistustulosten perusteella
- **Julkaisu-/tarkistuspolut**: Erilliset k√§sittelypolut hyv√§ksytylle ja hyl√§tylle sis√§ll√∂lle
- **Tilanhallinta**: S√§ilytt√§√§ sis√§ll√∂n ja tarkistuksen kontekstin ty√∂nkulun aikana

## üé® **Ehdolliset ty√∂nkulun suunnittelumallit**

### üìã **Sis√§ll√∂ntuotanto laatukynnyksill√§**
```
Outline ‚Üí Draft Creation ‚Üí Quality Review ‚Üí {Approve: Publish | Reject: Revise}
```

### üéØ **Riskiperusteinen asiakirjak√§sittely**
```
Document ‚Üí Risk Assessment ‚Üí {Low: Standard | High: Enhanced Review}
```

### üîç **√Ñlyk√§s asiakaspalvelun reititys**
```
Customer Query ‚Üí Analysis ‚Üí {Simple: FAQ Bot | Complex: Human Agent}
```

### üíº **Vaatimustenmukaisuuteen perustuvat ty√∂nkulut**
```
Content ‚Üí Compliance Check ‚Üí {Pass: Publish | Fail: Legal Review}
```

## üè¢ **Yritystason ehdolliset hy√∂dyt**

### üéØ **√Ñlyk√§s automaatio**
- **√Ñlyk√§s p√§√§t√∂ksenteko**: AI-ohjatut reititysp√§√§t√∂kset sis√§ll√∂n analyysin ja kontekstin perusteella
- **Mukautuva k√§sittely**: Ty√∂nkulut, jotka mukautuvat automaattisesti muuttuvien ehtojen mukaan
- **Liiketoimintas√§√§nt√∂jen noudattaminen**: Monimutkaisten liiketoimintas√§√§nt√∂jen ja k√§yt√§nt√∂jen automaattinen soveltaminen
- **Kontekstin huomioiva reititys**: P√§√§t√∂kset ty√∂nkulun historian ja kertyneen kontekstin perusteella

### üìà **Toiminnallinen huippuosaaminen**
- **Resurssien optimointi**: Ohjaa ty√∂t sopivimmille asiantuntijoille ja prosesseille
- **V√§hennetty manuaalinen puuttuminen**: Automaattinen p√§√§t√∂ksenteko minimoi ihmisen tekem√§n reitityksen tarpeen
- **Nopeammat ratkaisuajat**: Suora reititys sopivaan asiantuntemukseen ja k√§sittelykapasiteettiin
- **Johdonmukainen soveltaminen**: Liiketoimintas√§√§nt√∂jen ja p√§√§t√∂skriteerien yhten√§inen soveltaminen

### üõ°Ô∏è **Riskienhallinta ja vaatimustenmukaisuus**
- **Automaattinen riskinarviointi**: AI-ohjattu sis√§ll√∂n ja tilanteen riskitasojen arviointi
- **Vaatimustenmukaisuuden noudattaminen**: Automaattinen reititys vaadittujen s√§√§ntelyprosessien l√§pi
- **Turvaprotokollien soveltaminen**: Tehostetut turvatoimenpiteet riskinarvioinnin perusteella
- **Auditointij√§ljen yll√§pito**: Kaikkien reititysp√§√§t√∂sten ja perustelujen t√§ydellinen dokumentointi

### üìä **Analytiikka ja jatkuva parantaminen**
- **P√§√§t√∂sanalytiikka**: Seuraa reititysp√§√§t√∂sten tehokkuutta ja tarkkuutta
- **Kaavojen tunnistaminen**: Tunnista reititysp√§√§t√∂sten trendit ja kaavat ajan my√∂t√§
- **Suorituskyvyn optimointi**: P√§√§t√∂skriteerien ja reitityksen tehokkuuden jatkuva parantaminen
- **Liiketoimintatiedot**: N√§kemyksi√§ sis√§ll√∂n ominaisuuksista ja k√§sittelyvaatimuksista

### üîß **Tekninen huippuosaaminen**
- **Pysyv√§ tilanhallinta**: S√§ilyt√§ monimutkainen tila ty√∂nkulun suorituksen aikana
- **Skaalautuva arkkitehtuuri**: K√§sittele suurivolyymista ehdollista k√§sittely√§
- **Integrointikyvyt**: Saumaton integrointi olemassa oleviin liiketoimintaj√§rjestelmiin ja -prosesseihin
- **Seuranta ja havaittavuus**: Ty√∂nkulun suorituskyvyn ja p√§√§t√∂sten kattava seuranta

Rakennetaan √§lykk√§it√§, p√§√§t√∂ksentekoon perustuvia yritystason ty√∂nkulkuja .NET:ll√§! üöÄ

## üíª Koodin suorittaminen

T√§ydellinen toteutus l√∂ytyy tiedostosta `04.dotnet-agent-framework-workflow-aifoundry-condition.cs`. T√§m√§ esittelee **sis√§ll√∂ntuotannon ty√∂nkulun laatukynnyksill√§**:

### üèóÔ∏è **Ty√∂nkulun arkkitehtuuri**

```
Content Outline ‚Üí Draft Creation ‚Üí Quality Review ‚Üí Conditional Routing:
                                                      ‚îú‚îÄ Approved (>200 words) ‚Üí Publish
                                                      ‚îî‚îÄ Rejected (<200 words) ‚Üí Review Notification
```

**Ty√∂nkulun agentit:**
1. **Evangelist Agent**: Luo opetusmateriaalin luonnoksia Bingin taustatiedoin
2. **Content Reviewer Agent**: Arvioi luonnoksen laatua (sanam√§√§r√§, t√§ydellisyys)
3. **Publisher Agent**: Tallentaa hyv√§ksytyn sis√§ll√∂n aikaleimattuina Markdown-tiedostoina

**Mukautetut suorittajat:**
1. **DraftExecutor**: Orkestroi luonnoksen luomisen
2. **ContentReviewExecutor**: Suorittaa laadun arvioinnin
3. **PublishExecutor**: K√§sittelee hyv√§ksytyn sis√§ll√∂n julkaisemisen
4. **SendReviewExecutor**: Hallinnoi hyl√§tyn sis√§ll√∂n ilmoituksia

### üöÄ Esimerkin suorittaminen

**Esivaatimukset:**
- Azure AI Foundry -ty√∂tila konfiguroitu
- Azure CLI -autentikointi (`az login`)
- (Valinnainen) Bing Search -yhteys taustatietojen hankkimiseksi

```bash
# Make the script executable (Unix/Linux/macOS)
chmod +x 04.dotnet-agent-framework-workflow-aifoundry-condition.cs

# Run the conditional workflow
./04.dotnet-agent-framework-workflow-aifoundry-condition.cs
```

Tai Windowsissa:
```powershell
dotnet run 04.dotnet-agent-framework-workflow-aifoundry-condition.cs
```

### üìù Odotettu tulos

Ty√∂nkulku:
1. **Luo agentit**: Alustaa kolme erikoistunutta Azure AI Foundry -agenttia
2. **Luo luonnos**: Evangelist-agentti luo opetusmateriaalin luonnoksen
3. **Arvioi sis√§lt√∂**: Content Reviewer arvioi luonnoksen laatua
4. **Ehdollinen reititys**:
   - **Jos hyv√§ksytty (>200 sanaa)**: Publish Executor tallentaa Markdown-tiedostona
   - **Jos hyl√§tty (<200 sanaa)**: Send Review -ilmoitus l√§hetet√§√§n
5. **N√§yt√§ tulokset**: N√§ytt√§√§ ty√∂nkulun lopputuloksen

### üîß Mukautusvaihtoehdot

**Muokkaa tarkistuskriteerej√§:**
```csharp
const string ContentReviewerInstructions = @"
You are a content reviewer...
1. Check if content is more than 500 words (instead of 200)
2. Verify technical accuracy
3. Ensure proper formatting
...";
```

**Lis√§√§ ehdollisia polkuja:**
```csharp
var workflow = new WorkflowBuilder(draftExecutor)
    .AddEdge(draftExecutor, contentReviewerExecutor)
    .AddEdge(contentReviewerExecutor, publishExecutor, condition: GetCondition("Excellent"))
    .AddEdge(contentReviewerExecutor, editExecutor, condition: GetCondition("Good"))
    .AddEdge(contentReviewerExecutor, sendReviewerExecutor, condition: GetCondition("Poor"))
    .Build();
```

**Muuta sis√§lt√∂vaatimuksia:**
```csharp
string OUTLINE_Content = @"
# Your Custom Topic
## Section 1
https://your-reference-url
## Section 2
...
";
```

### üéØ Reaaliaikaiset sovellukset

T√§m√§ ehdollinen ty√∂nkulku sopii erityisesti:
- **Sis√§ll√∂nhallintaj√§rjestelm√§t**: Automatisoidut toimitukselliset ty√∂nkulut laatukynnyksill√§
- **Asiakirjak√§sittely**: Reitit√§ asiakirjat luokittelun ja vaatimustenmukaisuuden perusteella
- **Asiakastuki**: √Ñlyk√§s tikettien reititys monimutkaisuuden ja kiireellisyyden perusteella
- **Oikeudellinen tarkistus**: Reitit√§ sopimukset riskinarvioinnin ja arvon perusteella
- **HR-prosessit**: Reitit√§ hakemukset sopivien seulontaty√∂nkulkujen l√§pi

### üîç Ehdollisen logiikan ymm√§rt√§minen

**Ehtofunktio:**
```csharp
public Func<object?, bool> GetCondition(string expectedResult) =>
    reviewResult => reviewResult is ReviewResult review && review.Result == expectedResult;
```

T√§m√§ funktio luo predikaatin, joka:
1. Tarkistaa, onko tulos tyyppi√§ `ReviewResult`
2. Vertaa `Result`-ominaisuutta odotettuun arvoon
3. Palauttaa true/false reitityksen m√§√§ritt√§miseksi

**Ty√∂nkulun reunat ehdoilla:**
```csharp
.AddEdge(contentReviewerExecutor, publishExecutor, condition: GetCondition("Yes"))
.AddEdge(contentReviewerExecutor, sendReviewerExecutor, condition: GetCondition("No"))
```

### üìä Kehittyneet ominaisuudet

**JSON-skeeman validointi:**
Ty√∂nkulku k√§ytt√§√§ JSON-skeemoja rakenteellisten vastausten varmistamiseksi:

```csharp
// Define response structure
public class ReviewResult
{
    [JsonPropertyName("review_result")]
    public string Result { get; set; } = string.Empty;
    
    [JsonPropertyName("reason")]
    public string Reason { get; set; } = string.Empty;
    
    [JsonPropertyName("draft_content")]
    public string DraftContent { get; set; } = string.Empty;
}

// Apply to agent
ResponseFormat = ChatResponseFormat.ForJsonSchema(
    AIJsonUtilities.CreateJsonSchema(typeof(ReviewResult)), 
    "ReviewResult", 
    "Review Result From DraftContent"
)
```

**Bing Grounding -integraatio:**
Evangelist-agentti k√§ytt√§√§ Bing Groundingia reaaliaikaisen tiedon hankkimiseen:

```csharp
var bingGroundingConfig = new BingGroundingSearchConfiguration(bing_conn_id);
BingGroundingToolDefinition bingGroundingTool = new(
    new BingGroundingSearchToolParameters([bingGroundingConfig])
);
```

T√§m√§ mahdollistaa agentin seuraamaan outline-linkkej√§ ja poimimaan ajankohtaista tietoa.

### üõ°Ô∏è Virheenk√§sittely

Ty√∂nkulku sis√§lt√§√§ vankan virheenk√§sittelyn hyl√§tylle sis√§ll√∂lle:
- Tarkistuksen ep√§onnistuminen k√§ynnist√§√§ vaihtoehtoisen polun
- Ilmoitukset tarjoavat selke√§t hylk√§yssyyt
- Sis√§lt√∂ s√§ilytet√§√§n uudelleenk√§sittely√§ varten

### üîÑ Ty√∂nkulun laajentaminen

**Lis√§√§ palautesilmukka:**
Luo palautesilmukka, joka luo sis√§ll√∂n uudelleen automaattisesti:

```csharp
.AddEdge(contentReviewerExecutor, publishExecutor, condition: GetCondition("Yes"))
.AddEdge(contentReviewerExecutor, draftExecutor, condition: GetCondition("No")) // Loop back
```

**Toteuta monitasoinen tarkistus:**
Lis√§√§ useita tarkistusvaiheita eri kriteereill√§:

```csharp
.AddEdge(draftExecutor, technicalReviewer)
.AddEdge(technicalReviewer, editorialReviewer, condition: GetCondition("TechPass"))
.AddEdge(editorialReviewer, publishExecutor, condition: GetCondition("EditPass"))
```

T√§m√§ ehdollinen ty√∂nkulku tarjoaa perustan kehittyneiden, √§lykk√§iden yritysautomaation j√§rjestelmien rakentamiseen! üöÄ

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Vastuuvapauslauseke**:  
T√§m√§ asiakirja on k√§√§nnetty k√§ytt√§m√§ll√§ teko√§lypohjaista k√§√§nn√∂spalvelua [Co-op Translator](https://github.com/Azure/co-op-translator). Vaikka pyrimme tarkkuuteen, huomioithan, ett√§ automaattiset k√§√§nn√∂kset voivat sis√§lt√§√§ virheit√§ tai ep√§tarkkuuksia. Alkuper√§inen asiakirja sen alkuper√§isell√§ kielell√§ tulisi pit√§√§ ensisijaisena l√§hteen√§. Kriittisen tiedon osalta suositellaan ammattimaista ihmisk√§√§nn√∂st√§. Emme ole vastuussa v√§√§rink√§sityksist√§ tai virhetulkinnoista, jotka johtuvat t√§m√§n k√§√§nn√∂ksen k√§yt√∂st√§.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->