<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c268705e6fb2b30c7690d5b2a002e072",
  "translation_date": "2025-11-07T08:58:56+00:00",
  "source_file": "05-agentic-rag/code_samples/05-dotnet-agent-framework.md",
  "language_code": "ja"
}
-->
# 🔍 Azure AI Foundry (.NET) を使用したエンタープライズ RAG

## 📋 学習目標

このノートブックでは、Microsoft Agent Framework を使用して Azure AI Foundry 上でエンタープライズ向けの Retrieval-Augmented Generation (RAG) システムを構築する方法を示します。ドキュメントを検索し、正確で文脈に応じた回答を提供する、エンタープライズセキュリティとスケーラビリティを備えた本番環境対応のエージェントを作成する方法を学びます。

**構築するエンタープライズ RAG 機能:**
- 📚 **ドキュメントインテリジェンス**: Azure AI サービスを活用した高度なドキュメント処理
- 🔍 **セマンティック検索**: エンタープライズ機能を備えた高性能ベクトル検索
- 🛡️ **セキュリティ統合**: ロールベースのアクセス制御とデータ保護パターン
- 🏢 **スケーラブルなアーキテクチャ**: 監視機能を備えた本番環境対応の RAG システム

## 🎯 エンタープライズ RAG アーキテクチャ

### エンタープライズの主要コンポーネント
- **Azure AI Foundry**: セキュリティとコンプライアンスを備えたマネージドエンタープライズAIプラットフォーム
- **永続エージェント**: 会話履歴とコンテキスト管理を備えたステートフルエージェント
- **ベクトルストア管理**: エンタープライズ向けのドキュメントインデックス作成と検索
- **アイデンティティ統合**: Azure AD 認証とロールベースのアクセス制御

### .NET エンタープライズの利点
- **型安全性**: RAG 操作とデータ構造のコンパイル時検証
- **非同期パフォーマンス**: 非ブロッキングのドキュメント処理と検索操作
- **メモリ管理**: 大規模なドキュメントコレクションに対する効率的なリソース利用
- **統合パターン**: 依存性注入を活用したネイティブ Azure サービス統合

## 🏗️ 技術アーキテクチャ

### エンタープライズ RAG パイプライン
```
Document Upload → Security Validation → Vector Processing → Index Creation
                      ↓                    ↓                  ↓
User Query → Authentication → Semantic Search → Context Ranking → AI Response
```

### .NET の主要コンポーネント
- **Azure.AI.Agents.Persistent**: 状態の永続化を伴うエンタープライズエージェント管理
- **Azure.Identity**: 安全な Azure サービスアクセスのための統合認証
- **Microsoft.Agents.AI.AzureAI**: Azure に最適化されたエージェントフレームワーク実装
- **System.Linq.Async**: 高性能な非同期 LINQ 操作

## 🔧 エンタープライズ機能と利点

### セキュリティとコンプライアンス
- **Azure AD 統合**: エンタープライズアイデンティティ管理と認証
- **ロールベースのアクセス**: ドキュメントアクセスと操作のきめ細かい権限設定
- **データ保護**: 機密ドキュメントの保存時および転送時の暗号化
- **監査ログ**: コンプライアンス要件に対応した包括的な活動追跡

### パフォーマンスとスケーラビリティ
- **接続プーリング**: 効率的な Azure サービス接続管理
- **非同期処理**: 高スループットシナリオ向けの非ブロッキング操作
- **キャッシュ戦略**: 頻繁にアクセスされるドキュメントのインテリジェントキャッシュ
- **負荷分散**: 大規模展開向けの分散処理

### 管理と監視
- **ヘルスチェック**: RAG システムコンポーネントの組み込み監視
- **パフォーマンス指標**: 検索品質と応答時間に関する詳細な分析
- **エラーハンドリング**: 再試行ポリシーを伴う包括的な例外管理
- **構成管理**: 環境固有の設定とその検証

## ⚙️ 必要条件とセットアップ

**開発環境:**
- .NET 9.0 SDK 以上
- Visual Studio 2022 または C# 拡張機能付き VS Code
- Azure サブスクリプション（AI Foundry アクセス付き）

**必要な NuGet パッケージ:**
```xml
<PackageReference Include="Microsoft.Extensions.AI" Version="9.9.0" />
<PackageReference Include="Azure.AI.Agents.Persistent" Version="1.2.0-beta.5" />
<PackageReference Include="Azure.Identity" Version="1.15.0" />
<PackageReference Include="System.Linq.Async" Version="6.0.3" />
<PackageReference Include="DotNetEnv" Version="3.1.1" />
```

**Azure 認証設定:**
```bash
# Install Azure CLI and authenticate
az login
az account set --subscription "your-subscription-id"
```

**環境構成:**
* Azure AI Foundry の構成（Azure CLI を通じて自動的に処理）
* 正しい Azure サブスクリプションに認証されていることを確認

## 📊 エンタープライズ RAG パターン

### ドキュメント管理パターン
- **一括アップロード**: 大規模なドキュメントコレクションの効率的な処理
- **増分更新**: ドキュメントのリアルタイム追加と変更
- **バージョン管理**: ドキュメントのバージョン管理と変更追跡
- **メタデータ管理**: 豊富なドキュメント属性と分類体系

### 検索と取得パターン
- **ハイブリッド検索**: セマンティック検索とキーワード検索の組み合わせ
- **ファセット検索**: 多次元フィルタリングと分類
- **関連性調整**: ドメイン固有のニーズに対応したカスタムスコアリングアルゴリズム
- **結果ランキング**: ビジネスロジック統合による高度なランキング

### セキュリティパターン
- **ドキュメントレベルのセキュリティ**: ドキュメントごとのきめ細かいアクセス制御
- **データ分類**: 自動感度ラベリングと保護
- **監査トレイル**: すべての RAG 操作の包括的なログ記録
- **プライバシー保護**: PII 検出と編集機能

## 🔒 エンタープライズセキュリティ機能

### 認証と認可
```csharp
// Azure AD integrated authentication
var credential = new AzureCliCredential();
var agentsClient = new PersistentAgentsClient(endpoint, credential);

// Role-based access validation
if (!await ValidateUserPermissions(user, documentId))
{
    throw new UnauthorizedAccessException("Insufficient permissions");
}
```

### データ保護
- **暗号化**: ドキュメントと検索インデックスのエンドツーエンド暗号化
- **アクセス制御**: Azure AD を使用したユーザーおよびグループの権限設定
- **データ所在地**: コンプライアンスのための地理的データ配置制御
- **バックアップと復旧**: 自動バックアップと災害復旧機能

## 📈 パフォーマンス最適化

### 非同期処理パターン
```csharp
// Efficient async document processing
await foreach (var document in documentStream.AsAsyncEnumerable())
{
    await ProcessDocumentAsync(document, cancellationToken);
}
```

### メモリ管理
- **ストリーミング処理**: メモリ問題を回避しながら大規模ドキュメントを処理
- **リソースプーリング**: 高コストリソースの効率的な再利用
- **ガベージコレクション**: 最適化されたメモリ割り当てパターン
- **接続管理**: 適切な Azure サービス接続ライフサイクル

### キャッシュ戦略
- **クエリキャッシュ**: 頻繁に実行される検索のキャッシュ
- **ドキュメントキャッシュ**: ホットドキュメントのインメモリキャッシュ
- **インデックスキャッシュ**: 最適化されたベクトルインデックスキャッシュ
- **結果キャッシュ**: 生成された応答のインテリジェントキャッシュ

## 📊 エンタープライズユースケース

### ナレッジ管理
- **企業ウィキ**: 企業のナレッジベース全体でのインテリジェント検索
- **ポリシーと手順**: 自動化されたコンプライアンスと手順ガイダンス
- **トレーニング資料**: インテリジェントな学習と開発支援
- **研究データベース**: 学術論文や研究論文の分析システム

### カスタマーサポート
- **サポートナレッジベース**: 自動化されたカスタマーサービス応答
- **製品ドキュメント**: インテリジェントな製品情報検索
- **トラブルシューティングガイド**: 文脈に応じた問題解決支援
- **FAQ システム**: ドキュメントコレクションからの動的 FAQ 生成

### 規制コンプライアンス
- **法的文書分析**: 契約書や法的文書のインテリジェンス
- **コンプライアンス監視**: 自動化された規制コンプライアンスチェック
- **リスク評価**: ドキュメントベースのリスク分析とレポート
- **監査支援**: 監査向けのインテリジェントなドキュメント検索

## 🚀 本番環境へのデプロイ

### 監視と可観測性
- **Application Insights**: 詳細なテレメトリとパフォーマンス監視
- **カスタム指標**: ビジネス固有の KPI トラッキングとアラート
- **分散トレーシング**: サービス全体のリクエスト追跡
- **ヘルスダッシュボード**: システムのリアルタイムな健康状態とパフォーマンスの可視化

### スケーラビリティと信頼性
- **自動スケーリング**: 負荷とパフォーマンス指標に基づく自動スケーリング
- **高可用性**: フェイルオーバー機能を備えたマルチリージョン展開
- **負荷テスト**: エンタープライズ負荷条件下でのパフォーマンス検証
- **災害復旧**: 自動化されたバックアップと復旧手順

エンタープライズ規模で機密文書を処理できる RAG システムを構築する準備はできましたか？インテリジェントなナレッジシステムをエンタープライズ向けに設計しましょう！ 🏢📖✨

## コード実装

このレッスンの完全な動作コードサンプルは `05-dotnet-agent-framework.cs` にあります。

例を実行するには:

```bash
# Make the script executable (Linux/macOS)
chmod +x 05-dotnet-agent-framework.cs

# Run the .NET Single File App
./05-dotnet-agent-framework.cs
```

または、直接 `dotnet run` を使用:

```bash
dotnet run 05-dotnet-agent-framework.cs
```

このコードでは以下を示します:

1. **パッケージインストール**: Azure AI Agents 用の必要な NuGet パッケージのインストール
2. **環境構成**: Azure AI Foundry エンドポイントとモデル設定の読み込み
3. **ドキュメントアップロード**: RAG 処理用のドキュメントアップロード
4. **ベクトルストア作成**: セマンティック検索用のベクトルストア作成
5. **エージェント構成**: ファイル検索機能を備えた AI エージェントの設定
6. **クエリ実行**: アップロードされたドキュメントに対するクエリの実行

---

**免責事項**:  
この文書はAI翻訳サービス[Co-op Translator](https://github.com/Azure/co-op-translator)を使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。元の言語で記載された文書を正式な情報源としてご参照ください。重要な情報については、専門の人間による翻訳を推奨します。この翻訳の使用に起因する誤解や誤認について、当社は一切の責任を負いません。